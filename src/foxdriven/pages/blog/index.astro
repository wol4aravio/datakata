---
import { createDirectus, rest, readItems, authentication } from "@directus/sdk";

import MainLayout from "@foxdriven/layouts/MainLayout.astro";
import ArticleCard from "@foxdriven/components/ArticleCard.astro";

const cms_url = await import.meta.env.CMS_URL;
const cms_user = await import.meta.env.CMS_USER;
const cms_password = await import.meta.env.CMS_PASSWORD;

const client = createDirectus(cms_url).with(rest()).with(authentication());
await client.login(cms_user, cms_password);

const articles = await client.request(readItems("articles"));
console.log(articles);
console.log("Total:", articles.length);
---

<MainLayout page_title="Блог" page_description="Все публикации">
  <div class="mx-auto grid max-w-5xl grid-cols-1 justify-between gap-4">
    {
      articles.map((article) => {
        return (
          <ArticleCard
            title={article.title}
            slug={article.slug}
            year={article.year}
            url={article.url}
            tags={article.tags}
            description={article.description}
          />
        );
      })
    }
  </div>
</MainLayout>
